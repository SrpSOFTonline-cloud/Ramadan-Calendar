<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ramadan Calendar</title>
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="manifest.json">
</head>

<body>

<div class="app">

<h1>üåô ‡¶∞‡¶Æ‡¶ú‡¶æ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞</h1>
<p id="todayDate"></p>

<div class="today-box">
<h3>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü‡¶∏‡ßÇ‡¶ö‡¶ø</h3>
<p>‡¶∏‡ßá‡¶π‡¶∞‡¶ø: <span id="sehri">--</span></p>
<p>‡¶á‡¶´‡¶§‡¶æ‡¶∞: <span id="iftar">--</span></p>
<p id="countdown">‚è≥ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
</div>

<h3>‡¶∞‡¶Æ‡¶ú‡¶æ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞</h3>

<table>
<thead>
<tr>
<th>‡¶∞‡ßã‡¶ú‡¶æ</th>
<th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
<th>‡¶¨‡¶æ‡¶∞</th>
<th>‡¶∏‡ßá‡¶π‡¶∞‡¶ø</th>
<th>‡¶á‡¶´‡¶§‡¶æ‡¶∞</th>
</tr>
</thead>

<tbody id="ramadanTable">
<tr><td colspan="5">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
</tbody>
</table>

</div>

<script>
const year = new Date().getFullYear();
document.getElementById("todayDate").innerHTML =
new Date().toLocaleDateString("bn-BD");

async function loadRamadan(){

const url =
`https://api.aladhan.com/v1/calendarByCity?city=Dhaka&country=Bangladesh&method=1&month=2&year=${year}`;

const res = await fetch(url);
const data = await res.json();

const table = document.getElementById("ramadanTable");
table.innerHTML = "";

let count = 0;
let today = new Date().toDateString();

data.data.forEach(day => {

if(day.date.hijri.month.en === "Ramadan"){
count++;

let isToday =
new Date(day.date.gregorian.date).toDateString() === today;

let row = `
<tr ${isToday ? 'class="today-row"' : ''}>
<td>${count}</td>
<td>${day.date.gregorian.date}</td>
<td>${day.date.gregorian.weekday.ar}</td>
<td>${day.timings.Fajr.split(" ")[0]}</td>
<td>${day.timings.Maghrib.split(" ")[0]}</td>
</tr>`;

table.innerHTML += row;

if(isToday){
document.getElementById("sehri").innerText =
day.timings.Fajr.split(" ")[0];
document.getElementById("iftar").innerText =
day.timings.Maghrib.split(" ")[0];

startCountdown(day.timings.Maghrib.split(" ")[0]);
}
}
});
}

function startCountdown(iftarTime){
const cd = document.getElementById("countdown");

setInterval(()=>{
let now = new Date();

let [h,m] = iftarTime.split(":");
let iftar = new Date();
iftar.setHours(h,m,0);

let diff = iftar - now;

if(diff <= 0){
cd.innerText = "üåô ‡¶á‡¶´‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá!";
return;
}

let hrs = Math.floor(diff/1000/60/60);
let mins = Math.floor((diff/1000/60)%60);
let secs = Math.floor((diff/1000)%60);

cd.innerText =
`‚è≥ ‡¶á‡¶´‡¶§‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø: ${hrs}‡¶ò ${mins}‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ${secs}‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°`;
},1000);
}

loadRamadan();


// PWA service worker
if ("serviceWorker" in navigator) {
navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>

